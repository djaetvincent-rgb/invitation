<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#faf9f7" />
  <title>D & V — Invitation</title>

  <!-- Cache (GitHub Pages) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- Fonts (mobile-first, lisibles, chic) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:opsz,wght@6..96,400;6..96,500;6..96,600&family=Cormorant+Garamond:wght@300;400;500&family=Great+Vibes&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --ivory:#faf9f7;
      --gold:#c5a572;
      --ink:#1a1a1a;
      --ease:cubic-bezier(.25,.8,.25,1);
      --shadow: 0 22px 70px rgba(0,0,0,.12);
      --border: rgba(26,26,26,.12);
      --max: 900px;
      --editorial: 60ch;

      --font-didot: "Bodoni Moda","Didot","Bodoni MT","Times New Roman",serif;
      --font-body: "Cormorant Garamond","Times New Roman",serif;
      --font-caps: "Montserrat",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      --font-script: "Great Vibes",cursive;

      --tap: 48px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: var(--ivory);
      color: var(--ink);
      font-family: var(--font-body);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
      font-kerning: normal;
      font-variant-ligatures: common-ligatures discretionary-ligatures;
      overflow-x:hidden;
    }

    /* Papier */
    body::before{
      content:"";
      position:fixed; inset:0;
      z-index:-2;
      background: radial-gradient(1200px 900px at 50% 15%, #ffffff 0%, var(--ivory) 65%, #f4f1ec 100%);
    }
    body::after{
      content:"";
      position:fixed; inset:-80px;
      z-index:-1;
      opacity:.11;
      pointer-events:none;
      mix-blend-mode:multiply;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='320' height='320'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='320' height='320' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
    }

    [hidden]{ display:none !important; }

    /* ===================== MOBILE-FIRST COVER ===================== */
    .cover{
      min-height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px 14px 30px;
    }

    .coverWrap{
      width: min(520px, 100%);
      text-align:center;
    }

    .hintTop{
      font-family: var(--font-caps);
      text-transform: uppercase;
      letter-spacing: .26em;
      font-size: 12px;
      color: rgba(26,26,26,.62);
      margin-bottom: 14px;
    }

    /* ENVELOPPE 100% CSS -> fiable sur téléphone, pas d’images, pas de clip-path */
    .envStage{
      position:relative;
      margin: 0 auto;
      width: min(420px, 92vw);
      aspect-ratio: 4 / 3;
      filter: drop-shadow(var(--shadow));
      touch-action: manipulation;
    }

    .env{
      position:absolute; inset:0;
      border-radius: 22px;
      background:
        radial-gradient(900px 520px at 50% 0%, rgba(197,165,114,.12), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.8), rgba(250,249,247,.92));
      border: 1px solid var(--border);
      overflow:hidden;
    }

    /* dos */
    .envBack{
      position:absolute; inset:0;
      border-radius: 22px;
      background:
        radial-gradient(900px 520px at 50% 0%, rgba(0,0,0,.025), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.78), rgba(250,249,247,.92));
    }

    /* pli du bas (avant) */
    .envFront{
      position:absolute; left:0; right:0; bottom:0;
      height: 58%;
      background: linear-gradient(180deg, rgba(255,255,255,.00), rgba(0,0,0,.02));
      border-top: 1px solid rgba(26,26,26,.08);
      border-bottom-left-radius: 22px;
      border-bottom-right-radius: 22px;
      overflow:hidden;
    }
    .envFront::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(135deg, transparent 49%, rgba(26,26,26,.10) 50%, transparent 51%),
        linear-gradient(225deg, transparent 49%, rgba(26,26,26,.10) 50%, transparent 51%);
      opacity:.55;
    }
    .envFront::after{
      content:"";
      position:absolute; inset: 14px;
      border: 1px solid rgba(197,165,114,.35);
      border-radius: 16px;
      opacity:.85;
      pointer-events:none;
    }

    /* rabat */
    .flap{
      position:absolute; left:0; right:0; top:0;
      height: 62%;
      transform-origin: 50% 0%;
      backface-visibility:hidden;
      will-change: transform;
    }

    /* rabat en triangle via border trick */
    .flap::before{
      content:"";
      position:absolute; left:0; right:0; top:0; bottom:0;
      width:0; height:0;
      margin: 0 auto;
      border-left: calc(min(420px, 92vw) / 2) solid transparent;
      border-right: calc(min(420px, 92vw) / 2) solid transparent;
      border-top: calc((min(420px, 92vw) * 3 / 4) * .62) solid rgba(255,255,255,.92);
      filter: drop-shadow(0 10px 30px rgba(0,0,0,.08));
    }
    .flap::after{
      content:"";
      position:absolute; left:0; right:0; top:0;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(197,165,114,.55), transparent);
      opacity:.9;
      transform: translateY(10px);
    }

    /* carte qui sort */
    .card{
      position:absolute;
      left:50%;
      bottom: 12%;
      transform: translateX(-50%) translateY(34%);
      width: 84%;
      height: 72%;
      border-radius: 18px;
      background:
        radial-gradient(900px 600px at 50% 10%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.06), transparent 42%),
        #070707;
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 30px 90px rgba(0,0,0,.38);
      opacity: 0;
      will-change: transform, opacity;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:14px;
      border: 1px solid rgba(197,165,114,.42);
      border-radius: 14px;
      pointer-events:none;
      opacity:.95;
    }
    .card::after{
      content:"";
      position:absolute; inset:0;
      opacity:.9;
      mix-blend-mode: soft-light;
      background:
        radial-gradient(1100px 800px at 50% 40%, transparent 55%, rgba(0,0,0,.55)),
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='280' height='280'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='280' height='280' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
    }

    /* contenu carte */
    .cardInner{
      position:absolute; inset:0;
      padding: 18px 18px 16px;
      color: rgba(255,255,255,.95);
    }

    .bigMono{
      position:absolute;
      font-family: var(--font-didot);
      font-weight: 500;
      font-size: clamp(110px, 20vw, 190px);
      line-height: .85;
      opacity:.98;
      text-shadow: 0 14px 60px rgba(0,0,0,.55);
      user-select:none;
    }
    .bigMono.tr{ right: -14px; top: -18px; transform: rotate(6deg); }
    .bigMono.bl{ left: -18px; bottom: -22px; transform: rotate(-6deg); }

    .miniTop{
      font-family: var(--font-caps);
      font-size: 11px;
      letter-spacing: .24em;
      text-transform: uppercase;
      color: rgba(255,255,255,.66);
      max-width: 70%;
      text-align:left;
    }

    .mid{
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%,-48%);
      width: 90%;
      text-align:center;
    }
    .name{
      font-family: var(--font-script);
      font-size: clamp(34px, 7vw, 56px);
      line-height: 1.02;
      margin: 0;
      text-shadow: 0 12px 50px rgba(0,0,0,.40);
    }
    .andLine{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 12px;
      margin: 10px 0 6px;
    }
    .andLine::before,
    .andLine::after{
      content:"";
      height:1px;
      width: 28%;
      background: rgba(197,165,114,.65);
    }
    .andWord{
      font-family: var(--font-script);
      font-size: 40px;
      line-height:1;
      transform: translateY(2px);
      opacity:.95;
    }
    .tag{
      margin-top: 10px;
      font-family: var(--font-caps);
      font-size: 11px;
      letter-spacing: .30em;
      text-transform: uppercase;
      color: rgba(255,255,255,.76);
    }

    .metaCenter{
      position:absolute;
      left:50%;
      bottom: 16px;
      transform: translateX(-50%);
      font-family: var(--font-caps);
      font-size: 11px;
      letter-spacing:.22em;
      text-transform: uppercase;
      color: rgba(255,255,255,.74);
      white-space: nowrap;
    }

    .metaRight{
      position:absolute;
      right: 16px;
      bottom: 16px;
      text-align:right;
      font-family: var(--font-caps);
      font-size: 11px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color: rgba(255,255,255,.72);
      line-height: 1.5;
    }
    .metaRight strong{
      display:block;
      font-weight: 600;
      color: rgba(255,255,255,.90);
      letter-spacing:.20em;
      margin-bottom: 2px;
    }

    /* bouton tap large (SMS = téléphone) */
    .tapBtn{
      margin: 14px auto 0;
      width: min(420px, 92vw);
      min-height: var(--tap);
      border-radius: 999px;
      border: 1px solid rgba(26,26,26,.16);
      background: rgba(255,255,255,.88);
      box-shadow: 0 14px 40px rgba(0,0,0,.10);
      font-family: var(--font-caps);
      font-size: 12px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color: rgba(26,26,26,.86);
      cursor:pointer;
      touch-action: manipulation;
    }
    .tapBtn:active{ transform: translateY(1px); }

    /* ANIMATIONS: priorité fiabilité mobile (pas de parallax) */
    .envStage.open .card{
      animation: cardOut 1100ms var(--ease) forwards;
    }

    /* flap: 3D si support, sinon 2D */
    @supports (transform-style: preserve-3d){
      .envStage{
        perspective: 900px;
      }
      .flap{
        transform: rotateX(0deg);
        transform-style: preserve-3d;
      }
      .envStage.open .flap{
        animation: flapOpen3d 900ms var(--ease) forwards;
      }
      @keyframes flapOpen3d{
        0%{ transform: rotateX(0deg); }
        100%{ transform: rotateX(178deg); }
      }
    }
    @supports not (transform-style: preserve-3d){
      .flap{ transform: translateY(0) rotate(0deg); }
      .envStage.open .flap{
        animation: flapOpen2d 900ms var(--ease) forwards;
      }
      @keyframes flapOpen2d{
        0%{ transform: translateY(0) rotate(0deg); opacity:1; }
        100%{ transform: translateY(-18%) rotate(-12deg); opacity:.0; }
      }
    }

    @keyframes cardOut{
      0%{ opacity:0; transform: translateX(-50%) translateY(34%); }
      20%{ opacity:1; }
      100%{ opacity:1; transform: translateX(-50%) translateY(-10%); }
    }

    .fadeAway{
      animation: fadeAway 520ms var(--ease) forwards;
    }
    @keyframes fadeAway{
      to{ opacity:0; transform: translateY(6px); }
    }

    /* ===================== VIDEO (lisible mobile) ===================== */
    .videoPage{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px 14px 26px;
    }
    .videoWrap{
      width: min(920px, 100%);
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(26,26,26,.10);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 18px 14px 16px;
      position:relative;
      overflow:hidden;
    }
    .videoWrap::after{
      content:"";
      position:absolute; inset: 14px;
      border:1px solid rgba(197,165,114,.28);
      border-radius: 18px;
      pointer-events:none;
    }
    .videoInner{ position:relative; z-index:1; padding: 10px 6px 6px; text-align:center; }
    .videoTitle{
      font-family: var(--font-didot);
      font-weight: 500;
      letter-spacing:.18em;
      text-transform: uppercase;
      margin: 6px 0 6px;
      font-size: 18px;
      color: rgba(26,26,26,.92);
    }
    .videoSub{
      margin: 0 0 12px;
      font-family: var(--font-body);
      font-size: 17px;
      line-height:1.6;
      color: rgba(26,26,26,.82);
    }
    .videoBox{
      width:100%;
      aspect-ratio: 16 / 9;
      max-height: min(70vh, 520px);
      border-radius: 16px;
      overflow:hidden;
      background:#000;
      border: 1px solid rgba(26,26,26,.12);
      box-shadow: 0 14px 40px rgba(0,0,0,.10);
      margin: 0 auto;
    }
    .videoBox video{
      width:100%;
      height:100%;
      display:block;
      object-fit: contain; /* évite tout recadrage */
      background:#000;
    }

    /* ===================== PAGE LONGUE ===================== */
    .page{
      min-height:100vh;
      padding: 18px 14px 60px;
    }
    .sheet{
      width: min(var(--max), 100%);
      margin: 0 auto;
      background: rgba(255,255,255,.86);
      border: 1px solid rgba(26,26,26,.10);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .sheet::after{
      content:"";
      position:absolute; inset: 18px;
      border:1px solid rgba(197,165,114,.28);
      border-radius: 18px;
      pointer-events:none;
    }
    .sheetInner{
      position:relative;
      padding: 34px 14px 34px;
      text-align:center;
    }

    .topline{
      font-family: var(--font-caps);
      font-size: 12px;
      letter-spacing:.30em;
      text-transform: uppercase;
      color: rgba(26,26,26,.56);
      margin: 6px 0 10px;
    }
    .dv{
      font-family: var(--font-didot);
      font-weight: 500;
      font-size: clamp(58px, 12vw, 110px);
      letter-spacing:.22em;
      margin: 0 0 8px;
      background: linear-gradient(90deg, rgba(26,26,26,.92), var(--gold), rgba(26,26,26,.92));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .names{
      font-family: var(--font-body);
      font-size: clamp(22px, 5.2vw, 34px);
      margin: 0;
      color: rgba(26,26,26,.92);
      font-weight: 500;
    }
    .marry{
      margin: 8px 0 0;
      font-size: 18px;
      font-style: italic;
      color: rgba(26,26,26,.78);
    }
    .rule{
      width: 92px;
      height:1px;
      background: rgba(197,165,114,.70);
      margin: 16px auto 10px;
      opacity:.9;
    }
    .intro{
      margin: 10px auto 0;
      max-width: var(--editorial);
      font-size: 17px;
      line-height:1.9;
      color: rgba(26,26,26,.82);
      font-style: italic;
    }
    .dateBig{
      margin-top: 16px;
      font-family: var(--font-didot);
      font-weight: 500;
      font-size: 38px;
      letter-spacing:.20em;
      text-transform: uppercase;
      color: rgba(26,26,26,.96);
    }

    .block{ padding: 18px 10px; }
    .blockTitle{
      font-family: var(--font-didot);
      font-weight: 500;
      font-size: 20px;
      letter-spacing:.28em;
      text-transform: uppercase;
      margin: 0 0 10px;
      color: rgba(26,26,26,.96);
    }
    .blockTitle::after{
      content:"";
      display:block;
      width: 64px;
      height:1px;
      background: rgba(197,165,114,.75);
      margin: 10px auto 0;
    }
    .text{
      max-width: var(--editorial);
      margin: 0 auto;
      font-size: 19px;
      line-height:1.75;
      color: rgba(26,26,26,.90);
    }
    .text strong{ font-weight: 600; color: rgba(26,26,26,.96); }
    .small{
      max-width: var(--editorial);
      margin: 0 auto;
      font-size: 16px;
      line-height:1.8;
      color: rgba(26,26,26,.76);
    }

    .pair{
      display:grid;
      gap: 12px;
      margin-top: 10px;
      max-width: 760px;
      margin-left:auto;
      margin-right:auto;
    }
    .pair .box{
      border: 1px solid rgba(197,165,114,.22);
      border-radius: 16px;
      padding: 12px 12px;
      background: rgba(255,255,255,.70);
      text-align:left;
    }

    /* RSVP */
    .rsvpCard{
      position:relative;
      max-width: 780px;
      margin: 14px auto 0;
      border-radius: 22px;
      border: 1px solid rgba(197,165,114,.40);
      background: rgba(255,255,255,.92);
      box-shadow: var(--shadow);
      overflow:hidden;
      isolation:isolate;
    }
    .rsvpInner{
      position:relative;
      z-index:2;
      padding: 18px 14px 16px;
    }
    .rsvp{ text-align:left; max-width: 640px; margin: 0 auto; }
    .row{ display:grid; gap: 12px; }
    .label{
      font-family: var(--font-caps);
      font-size: 12px;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(26,26,26,.72);
      margin-bottom: 6px;
    }
    .row input, .row select, .row textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(26,26,26,.18);
      background: rgba(255,255,255,.98);
      font-family: var(--font-caps);
      font-size: 15px;
      color: var(--ink);
      outline:none;
    }
    .row input:focus, .row select:focus, .row textarea:focus{
      border-color: rgba(197,165,114,.70);
      box-shadow: 0 0 0 3px rgba(197,165,114,.18);
    }
    .row textarea{ resize: vertical; }

    .actions{
      display:grid;
      gap: 10px;
      margin-top: 12px;
    }
    .btn{
      min-height: var(--tap);
      border:1px solid rgba(26,26,26,.18);
      border-radius:999px;
      padding: 12px 16px;
      font-family: var(--font-caps);
      font-size: 12px;
      letter-spacing:.18em;
      text-transform: uppercase;
      cursor:pointer;
      background:#fff;
      color: rgba(26,26,26,.90);
    }
    .btn.primary{
      background:#1a1a1a;
      color:#fff;
      border: 1px solid rgba(197,165,114,.70);
    }
    .btn:active{ transform: translateY(1px); }

    .status{
      text-align:center;
      margin-top:10px;
      font-size: 14px;
      color: rgba(26,26,26,.78);
      min-height: 22px;
    }
    #sentPanel{
      display:none;
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(197,165,114,.35);
      background:rgba(255,255,255,.95);
      text-align:center;
    }
    #sentPanel.show{ display:block; }

    .field-error{
      border-color: rgba(200, 60, 60, .55) !important;
      box-shadow: 0 0 0 3px rgba(200, 60, 60, .12) !important;
    }
    .is-disabled{ opacity:.55; pointer-events:none; }

    .footer{
      text-align:center;
      padding: 10px 0 0;
      color: rgba(26,26,26,.68);
      font-size: 13px;
      letter-spacing:.08em;
    }

    @media (min-width: 720px){
      .sheetInner{ padding: 44px 40px 44px; }
      .pair{ grid-template-columns: 1fr 1fr; }
      .actions{ grid-template-columns: 1fr 1fr; }
    }

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
    }
  </style>
</head>

<body>

  <!-- ===================== COVER (SMS / MOBILE FIRST) ===================== -->
  <section id="cover" class="cover" aria-label="Enveloppe">
    <div class="coverWrap">
      <div class="hintTop">Invitation</div>

      <div class="envStage" id="envStage" role="img" aria-label="Enveloppe">
        <div class="env">
          <div class="envBack"></div>

          <div class="card" id="card" aria-hidden="true">
            <div class="cardInner">
              <div class="bigMono tr">V</div>
              <div class="bigMono bl">D</div>

              <div class="miniTop">NOUS VOUS INVITONS À NOTRE MARIAGE</div>

              <div class="mid">
                <p class="name">Djanomo</p>
                <div class="andLine"><span class="andWord">et</span></div>
                <p class="name" style="margin:0;">Vincent</p>
                <div class="tag">SE MARIENT</div>
              </div>

              <div class="metaCenter">SAMEDI 15 AOÛT 2026</div>
              <div class="metaRight">
                <strong>18:00</strong>
                RÉCEPTION<br/>DOMAINE DES TROIS LYS
              </div>
            </div>
          </div>

          <div class="flap" aria-hidden="true"></div>
          <div class="envFront" aria-hidden="true"></div>
        </div>
      </div>

      <button id="openBtn" class="tapBtn" type="button" aria-label="Ouvrir l’invitation">
        Ouvrir l’invitation
      </button>
    </div>
  </section>

  <!-- ===================== VIDEO ===================== -->
  <section id="videoPage" class="videoPage" aria-label="Vidéo" hidden>
    <div class="videoWrap">
      <div class="videoInner">
        <h2 class="videoTitle">Vidéo</h2>
        <p class="videoSub">Regarde la vidéo, puis appuie sur <strong>Continuer</strong>.</p>

        <div class="videoBox">
          <video id="inviteVideo"
                 controls
                 playsinline
                 preload="metadata"
                 controlslist="nodownload"
                 disablepictureinpicture>
            <source src="./video.mp4" type="video/mp4">
            Votre navigateur ne supporte pas la lecture vidéo.
          </video>
        </div>

        <div style="margin-top:12px;">
          <button class="btn primary" id="videoContinueBtn" type="button">Continuer</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ===================== PAGE LONGUE ===================== -->
  <main id="page" class="page" hidden aria-live="polite">
    <div class="sheet">
      <div class="sheetInner">
        <div class="topline">Invitation</div>
        <div class="dv">D&nbsp;&amp;&nbsp;V</div>
        <p class="names">Djanomo &amp; Vincent</p>
        <p class="marry">se marient</p>
        <div class="rule"></div>

        <p class="intro">
          10 ans de nous... 10 ans, c’est tout ?<br/>
          Aujourd’hui on se dit oui.<br/>
          Simplement mais intensément.
        </p>

        <div class="dateBig">15 AOÛT 2026</div>

        <section class="block">
          <h2 class="blockTitle">Programme</h2>

          <div class="pair">
            <div class="box">
              <p class="text"><strong>Mairie — 14h00</strong></p>
              <p class="small">1 Pl. de Gaulle<br/>27320 Saint-Germain-sur-Avre</p>
            </div>
            <div class="box">
              <p class="text"><strong>Église — 15h30</strong></p>
              <p class="small">4 Pl. de Gaulle<br/>27320 Saint-Germain-sur-Avre</p>
            </div>
          </div>

          <div style="margin-top:12px;">
            <p class="text"><strong>Réception — 18h00</strong></p>
            <p class="small">Domaine des Trois Lys<br/>1 La Moufle<br/>28500 Vert-en-Drouais</p>
          </div>
        </section>

        <section class="block">
          <h2 class="blockTitle">Couchages</h2>
          <p class="text"><strong>25 couchages</strong> disponibles.</p>
          <p class="small">
            Les couchages seront attribués <strong>dans l’ordre de réception des demandes</strong>.
            Si besoin, nous pourrons vous transmettre des adresses de <strong>gîtes</strong> et <strong>hôtels</strong> à proximité.
          </p>
        </section>

        <section class="block">
          <h2 class="blockTitle">Menu</h2>
          <p class="text"><strong>Cuisine franco-sénégalaise</strong>.</p>
          <p class="small">Merci de nous signaler toute allergie ou contrainte alimentaire.</p>
        </section>

        <section class="block" id="rsvp">
          <h2 class="blockTitle">Confirmation de présence</h2>
          <p class="small" style="text-align:center;margin:0 0 10px;">Merci de confirmer votre présence.</p>

          <div class="rsvpCard">
            <div class="rsvpInner">
              <div class="rsvp">
                <form id="rsvpForm" autocomplete="on" novalidate>
                  <!-- honeypot -->
                  <div style="position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden;">
                    <label>Ne pas remplir</label>
                    <input name="website" tabindex="-1" autocomplete="off">
                  </div>

                  <div class="row">
                    <div>
                      <div class="label">Nom & prénom</div>
                      <input id="f_name" name="name" required placeholder="Ex : Camille Dupont" autocomplete="name">
                    </div>

                    <div>
                      <div class="label">Présence</div>
                      <select id="f_attendance" name="attendance" required>
                        <option value="" selected disabled>Choisir…</option>
                        <option value="Oui">Oui, je viens</option>
                        <option value="Non">Non, je ne pourrai pas</option>
                      </select>
                    </div>

                    <div>
                      <div class="label">Adultes</div>
                      <input id="f_adults" name="adults" type="number" min="0" value="1" inputmode="numeric">
                    </div>

                    <div>
                      <div class="label">Enfants</div>
                      <input id="f_children" name="children" type="number" min="0" value="0" inputmode="numeric">
                    </div>

                    <div>
                      <div class="label">Couchage</div>
                      <select id="f_sleep" name="sleep">
                        <option value="" selected disabled>Choisir…</option>
                        <option value="Oui">Oui, je souhaite un couchage</option>
                        <option value="Non">Non, pas de couchage</option>
                      </select>
                    </div>

                    <div>
                      <div class="label">Allergies / régimes</div>
                      <textarea id="f_allergies" name="allergies" rows="3" placeholder="Ex : fruits à coque, gluten, végétarien…"></textarea>
                    </div>
                  </div>

                  <div class="actions">
                    <button class="btn primary" id="sendBtn" type="submit">Envoyer</button>
                    <button class="btn" type="button" id="copyBtn">Copier</button>
                  </div>

                  <div class="status" id="status"></div>

                  <div id="sentPanel">
                    <div style="font-family:var(--font-didot); letter-spacing:.16em; text-transform:uppercase;">Merci ✦</div>
                    <div style="margin-top:6px; opacity:.82;">Votre réponse est bien enregistrée.</div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </section>

        <div class="footer">Djanomo &amp; Vincent</div>
      </div>
    </div>
  </main>

  <script>
    // MOBILE-FIRST: pas de parallax, pas de "fixed cover" fragile sur iOS.
    const cover = document.getElementById("cover");
    const envStage = document.getElementById("envStage");
    const openBtn = document.getElementById("openBtn");

    const videoPage = document.getElementById("videoPage");
    const inviteVideo = document.getElementById("inviteVideo");
    const videoContinueBtn = document.getElementById("videoContinueBtn");

    const page = document.getElementById("page");

    let opened = false;

    function showVideo(){
      cover.hidden = true;
      videoPage.hidden = false;
      window.scrollTo(0,0);
    }

    function showPage(){
      try{ inviteVideo?.pause?.(); }catch(_){}
      videoPage.hidden = true;
      page.hidden = false;
      window.scrollTo(0,0);
    }

    function openEnvelope(){
      if(opened) return;
      opened = true;

      envStage.classList.add("open");
      openBtn.disabled = true;
      openBtn.textContent = "Ouverture…";

      // on laisse l’animation se faire, puis on bascule sur la vidéo
      setTimeout(() => {
        envStage.classList.add("fadeAway");
        setTimeout(showVideo, 380);
      }, 1200);
    }

    // Events fiables mobile: click + pointerdown
    function bind(el, type, fn, opts){
      if(!el) return;
      try{ el.addEventListener(type, fn, opts); }catch(_){ el.addEventListener(type, fn); }
    }

    bind(openBtn, "click", (e)=>{ e.preventDefault(); openEnvelope(); });
    bind(openBtn, "pointerdown", (e)=>{ e.preventDefault(); openEnvelope(); });

    // tap sur l’enveloppe = ouvrir
    bind(envStage, "click", (e)=>{ e.preventDefault(); openEnvelope(); });
    bind(envStage, "pointerdown", (e)=>{ e.preventDefault(); openEnvelope(); });

    if(videoContinueBtn){
      const handler = (e)=>{
        e.preventDefault();
        e.stopPropagation();
        showPage();
      };
      bind(videoContinueBtn, "click", handler);
      bind(videoContinueBtn, "pointerdown", handler);
    }

    // ========= RSVP (identique à ton logique, simplifiée visuellement) =========
    const APPS_SCRIPT_ENDPOINT = "https://script.google.com/macros/s/AKfycbzg1nIvnWwedsz7bGqqhv0qTFtSi6w-I0JeoLIYWrKlmjkWgxI5MueyXMj5ywb8rAf8/exec";
    const form = document.getElementById("rsvpForm");
    const copyBtn = document.getElementById("copyBtn");
    const sendBtn = document.getElementById("sendBtn");
    const statusEl = document.getElementById("status");
    const sentPanel = document.getElementById("sentPanel");

    const fName = document.getElementById("f_name");
    const fAttendance = document.getElementById("f_attendance");
    const fAdults = document.getElementById("f_adults");
    const fChildren = document.getElementById("f_children");
    const fSleep = document.getElementById("f_sleep");
    const fAllergies = document.getElementById("f_allergies");

    let isSending = false;

    function safeInt(v, def=0){
      const n = parseInt(v ?? def, 10);
      return Number.isFinite(n) ? Math.max(0, n) : def;
    }
    function clearErrors(){
      [fName, fAttendance, fAdults, fChildren, fSleep].forEach(el => el?.classList.remove("field-error"));
    }
    function setSendingUI(on){
      isSending = on;
      if(sendBtn){
        sendBtn.disabled = on;
        sendBtn.textContent = on ? "Envoi…" : "Envoyer";
        sendBtn.style.opacity = on ? "0.7" : "1";
      }
      if(copyBtn){
        copyBtn.disabled = on;
        copyBtn.style.opacity = on ? "0.7" : "1";
      }
    }
    function showSentPanel(){
      if(!sentPanel) return;
      sentPanel.classList.add("show");
      setTimeout(() => sentPanel.classList.remove("show"), 6000);
    }

    function updateFormByAttendance(){
      const att = fAttendance?.value;
      const isYes = att === "Oui";
      const isNo  = att === "Non";

      if(isNo){
        fAdults.value = "0";
        fChildren.value = "0";
        fAdults.disabled = true;
        fChildren.disabled = true;
        fSleep.disabled = true;

        fAdults.classList.add("is-disabled");
        fChildren.classList.add("is-disabled");
        fSleep.classList.add("is-disabled");
      } else {
        fAdults.disabled = false;
        fChildren.disabled = false;
        fSleep.disabled = false;

        fAdults.classList.remove("is-disabled");
        fChildren.classList.remove("is-disabled");
        fSleep.classList.remove("is-disabled");

        if(isYes){
          if(!fAdults.value) fAdults.value = "1";
          if(!fChildren.value) fChildren.value = "0";
        }
      }
    }

    function getData(){
      const fd = new FormData(form);
      const obj = Object.fromEntries(fd.entries());
      return {
        name: (obj.name || "").trim(),
        attendance: obj.attendance || "",
        adults: safeInt(obj.adults, 0),
        children: safeInt(obj.children, 0),
        sleep: (obj.sleep || ""),
        allergies: (obj.allergies || "").trim(),
        website: (obj.website || "").trim(),
        ts: new Date().toISOString()
      };
    }

    function buildMessage(data){
      return [
        "RSVP — Mariage Djanomo & Vincent (15/08/2026)",
        "",
        "Nom : " + data.name,
        "Présence : " + data.attendance,
        "Adultes : " + data.adults,
        "Enfants : " + data.children,
        "Couchage : " + (data.sleep || "—"),
        "Allergies / régimes : " + (data.allergies || "—")
      ].join("\n");
    }

    function cheapHash(s){
      let h = 2166136261;
      for(let i=0;i<s.length;i++){
        h ^= s.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return (h >>> 0).toString(16);
    }
    async function makeFingerprint(str){
      try{
        if(crypto?.subtle){
          const enc = new TextEncoder().encode(str);
          const buf = await crypto.subtle.digest("SHA-256", enc);
          return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,"0")).join("");
        }
      }catch(_){}
      return cheapHash(str);
    }
    function safeGetLS(k){ try{ return localStorage.getItem(k); }catch(_){ return null; } }
    function safeSetLS(k,v){ try{ localStorage.setItem(k,v); }catch(_){ } }

    async function sendToSheetNoCors(data){
      const body = JSON.stringify(data);
      try{
        if(navigator.sendBeacon){
          const blob = new Blob([body], {type:"text/plain;charset=utf-8"});
          const ok = navigator.sendBeacon(APPS_SCRIPT_ENDPOINT, blob);
          if(ok) return;
        }
      }catch(_){}
      await fetch(APPS_SCRIPT_ENDPOINT, {
        method: "POST",
        mode: "no-cors",
        cache: "no-store",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body,
        keepalive: true
      });
    }

    if(fAttendance){
      bind(fAttendance, "change", () => {
        updateFormByAttendance();
        statusEl.textContent = "";
        clearErrors();
      });
    }
    updateFormByAttendance();

    if(form){
      bind(form, "submit", async (e) => {
        e.preventDefault();
        if(isSending) return;

        clearErrors();
        statusEl.textContent = "";

        const data = getData();

        if(data.website){
          showSentPanel();
          form.reset();
          fAdults.value = "1";
          fChildren.value = "0";
          updateFormByAttendance();
          return;
        }

        if(!data.name){
          fName.classList.add("field-error");
          statusEl.textContent = "Merci d’indiquer votre nom.";
          return;
        }
        if(!data.attendance){
          fAttendance.classList.add("field-error");
          statusEl.textContent = "Merci de choisir votre présence.";
          return;
        }
        if(data.attendance === "Oui"){
          if(!data.sleep){
            fSleep.classList.add("field-error");
            statusEl.textContent = "Merci d’indiquer si vous souhaitez un couchage.";
            return;
          }
          if((data.adults + data.children) <= 0){
            fAdults.classList.add("field-error");
            fChildren.classList.add("field-error");
            statusEl.textContent = "Merci d’indiquer le nombre de personnes.";
            return;
          }
        }

        const fpBase = `${data.name}|${data.attendance}|${data.adults}|${data.children}|${data.sleep}|${data.allergies}`;
        const fp = await makeFingerprint(fpBase);
        const key = "rsvp_last_" + fp;
        const last = Number(safeGetLS(key) || "0");
        const now = Date.now();
        if(last && (now - last) < (30 * 60 * 1000)){
          statusEl.textContent = "Déjà envoyé récemment (anti-doublon).";
          return;
        }

        statusEl.textContent = "Envoi en cours…";
        setSendingUI(true);

        try{
          await sendToSheetNoCors(data);
          safeSetLS(key, String(now));
          statusEl.textContent = "Merci. Réponse envoyée.";
          showSentPanel();

          form.reset();
          fAdults.value = "1";
          fChildren.value = "0";
          updateFormByAttendance();
        }catch(err){
          const msg = buildMessage(data);
          try{ await navigator.clipboard.writeText(msg); }catch(_){}
          statusEl.textContent = "Envoi impossible. Message copié : colle-le dans WhatsApp/SMS.";
        }finally{
          setSendingUI(false);
        }
      });
    }

    if(copyBtn){
      bind(copyBtn, "click", async () => {
        clearErrors();
        const data = getData();
        const msg = buildMessage(data);
        try{
          await navigator.clipboard.writeText(msg);
          statusEl.textContent = "Message copié.";
        }catch(e){
          statusEl.textContent = "Copie impossible sur cet appareil.";
        }
      });
    }
  </script>
</body>
</html>
